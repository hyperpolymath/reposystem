// SPDX-License-Identifier: PMPL-1.0-or-later
// SPDX-FileCopyrightText: 2025 Jonathan D.A. Jewell
= Reposystem Roadmap
:toc: preamble
:toclevels: 3

f/i staged development plan for Reposystem — the railway yard for your repository ecosystem.

== Vision

A visual wiring layer that sits above individual repos, allowing you to:

1. **Import** repositories (yours + upstreams)
2. **Identify** components/slots/providers
3. **Rewire** projects by switching providers (local ↔ ecosystem ↔ fallback)
4. **Tag** with aspects (security, reliability, etc.) and flip views
5. **Reason** about the dependency graph including contingency paths

== Current Status (2026-01-26)

Reposystem is in implementation phase with the core pipeline complete:

* Local scan + graph store + JSON/DOT export
* Slots/providers/compatibility registry
* Plans, diffs, rollback + apply/audit flow
* TUI explorer
* Web UI prototype (static graph explorer, ER mode, annotations)

== Technology Stack

[cols="1,2,2"]
|===
|Layer |Language |Notes

|Core data model
|Rust
|Graph store + persistence

|CLI + TUI
|Rust
|Cross-platform with Ratatui for TUI

|State files
|Guile Scheme
|STATE.scm, META.scm, ECOSYSTEM.scm

|Web UI (prototype)
|HTML/CSS/JavaScript
|No-build static UI under `web/`

|Graph export
|DOT/SVG + JSON
|Standard formats
|===

== f/i Staged Plan

=== f1 — Freeze: MVC Graph + Tagging + Export

==== MUST (Freeze Criteria)

* [x] **Repo importer** — Import from local folder of git clones
* [x] **Persistent graph store** — Nodes, edges, groups in JSON
* [x] **Manual edges** — Create relationships between repos
* [x] **Manual groups** — Cluster repos into logical units
* [x] **Manual aspect tags** — Tag nodes/edges with aspects
* [x] **View filters** — Filter by group, by aspect
* [x] **Export DOT** — Graphviz-compatible output
* [x] **Export JSON** — Machine-readable graph export
* [x] **Re-import fidelity** — Re-import exported JSON → identical graph

==== SHOULD

* [x] Lightweight auto-suggestions (non-authoritative)
* [x] Basic edge auto-detection from config/imports

==== COULD

* [x] Basic "weak link" lens
* [x] Simple TUI for interactive exploration

==== Freeze Criteria

You can import 50+ repos, group them, tag them, export the graph, re-open it later unchanged.

---

=== i1 — Seam Review: Graph ↔ Evidence ↔ Export

* [x] Graph determinism check
* [x] Tag provenance check
* [x] Export fidelity check

---

=== f2 — Freeze: Slots/Providers Registry

==== MUST

* [x] **Slot definitions** — Declare what can be swapped
* [x] **Provider definitions** — Declare what provides a slot
* [x] **Repo-to-provider links** — Provider X is implemented by repo Y
* [x] **Slot/provider overlay in graph** — Visual indication

==== SHOULD

* [x] Compatibility metadata (version, interface kind)
* [x] Adapter stubs (declared, not executed)

==== COULD

* [x] Scenario snapshots (local vs ecosystem) in graph only
* [x] "What if" visualisation without actual changes

---

=== i2 — Seam Review: Slot Model ↔ Aspect Model

* [x] Provider substitution invariants
* [x] Aspect attachment invariants
* [x] No hidden edges

---

=== f3 — Freeze: Plan Generation + Dry-Run Diff

==== MUST

* [x] **Create plan from scenario** — Choose switches, generate plan
* [x] **Dry-run diff** — Show intended file changes as patches
* [x] **Rollback plan** — Define reversal (even if not executed yet)

==== SHOULD

* [x] Validate plan against compatibility + smoke-test hooks (declared)
* [x] Risk assessment per edge change

==== COULD

* [x] Auto-fallback logic (policy-level)
* [x] Plan comparison between scenarios

---

=== i3 — Seam Review: Plan ↔ Apply ↔ Rollback

* [x] Plan replayability
* [x] Diff accuracy
* [x] Rollback completeness

---

=== f4 — Freeze: Apply + Rollback Execution

==== MUST

* [x] **Apply plan** — Execute changes to repos
* [x] **Rollback** — Revert to previous state
* [x] **Audit log** — Record all applied changes

==== SHOULD

* [x] Health checks post-apply
* [x] Auto-rollback on failure

==== COULD

* [x] Staged apply (one repo at a time with confirmation)
* [x] Backup before apply

---

=== f5 — Freeze: Interactive UI (TUI + Web)

==== MUST

* [x] Switch toggles (local/ecosystem/auto)
* [x] Preview diffs before apply
* [x] Show risk flags per change
* [x] Keyboard navigation
* [x] Mouse support

==== SHOULD

* [x] Aspect flip views
* [x] Scenario comparison side-by-side

==== COULD

* [x] Web UI with annotations + ER mode

---

=== f6 — Freeze: GUI Railway Yard (Polish)

==== COULD

* [ ] Drag-and-drop canvas
* [ ] Point-switches with visual feedback
* [ ] Animated routing preview
* [ ] Contingency paths visualisation
* [ ] Multi-user collaboration

== "Hello Yard" Milestone

=== Scope

Pick one slot and support it end-to-end:

* **Slot**: `container.runtime`
* **Providers**: `podman` (local), `cerro-torre` (ecosystem)
* **Consumer repos**: 2–3 repos that do container work

=== Deliverables

1. `spec/DATA-MODEL.adoc` — Done ✓
2. `spec/CONCEPTS.adoc` — Done ✓
3. `registry.adoc` — Done ✓
4. CLI commands — Done ✓

== MVP Definition

=== What's In

* Import repos from local folder
* Create graph (nodes = repos, edges = relationships)
* Group repos manually
* Tag nodes/edges with aspects manually
* "Flip view" to show chosen aspect
* Export to DOT + JSON

=== What's Out (for Now)

* Forge API integration (GitHub/GitLab)
* Auto-application of changes without explicit plan

== Existing Tool Mapping

Where existing tools can help:

[cols="1,2,2"]
|===
|Component |Existing Tool |Notes

|Graph visualization
|Graphviz, D2, Mermaid
|DOT export target

|TUI framework
|Ratatui (Rust)
|Terminal UI

|Diagramming reference
|Structurizr, PlantUML
|Concept inspiration
|===

== Gap Analysis

What doesn't exist yet (the value proposition):

[cols="1,3"]
|===
|Gap |What Reposystem Provides

|Multi-repo component graph
|Graph of repos + components + programmable switches

|Aspect tagging
|Orthogonal view layers on dependency graph

|Component substitution with rollback
|Built-in provider swap with reversibility

|Scenario comparison
|A/B testing with aspect impact analysis
|===

== Success Criteria

=== f1 Complete When

* Import 50+ repos, group and tag them, export and re-open without loss.

=== f6 Complete When

* Non-technical users can explore and annotate the ecosystem safely.
